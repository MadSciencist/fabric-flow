(this.webpackJsonpmatty=this.webpackJsonpmatty||[]).push([[0],{14:function(t,e,i){},20:function(t,e){},21:function(t,e){},22:function(t,e){},23:function(t,e,i){"use strict";i.r(e);var r=i(1),n=i(2),o=i.n(n),a=i(6),s=i.n(a),l=(i(14),i(3)),c=i(5),d=i(7),h=i(0),f=i(24),p=h.fabric.util.createClass(h.fabric.Group,{type:"node",superType:"node",parentId:null,initialize:function(t){t=t||{};this.label=new h.fabric.Text("Default Node",{fontSize:16,fontFamily:"polestar",fontWeight:500,fill:"rgba(255, 255, 255, 0.8)"});var e=[new h.fabric.Rect({rx:10,ry:10,width:100,height:50,fill:t.fill||"rgba(0, 0, 0, 0.3)",stroke:t.stroke||"rgba(0, 0, 0, 0)",strokeWidth:2}),this.label],i=Object.assign({},t,{id:t.id||Object(f.a)(),width:100,height:50,originX:"left",originY:"top",hasRotatingPoint:!0,hasControls:!0});this.callSuper("initialize",e,i),this.label.set({top:this.label.top+this.label.height/2+4,left:this.label.left+35})},toObject:function(){return h.fabric.util.object.extend(this.callSuper("toObject"),{id:this.get("id"),superType:this.get("superType"),parentId:this.get("parentId")})},_render:function(t){this.callSuper("_render",t)}}),u=h.fabric.util.createClass(h.fabric.Group,{type:"subProcess",superType:"subProcess",children:[],initialize:function(t){t=t||{},this.children=t.children||[];this.label=new h.fabric.Text("Default Node",{fontSize:16,fontFamily:"polestar",fontWeight:500,fill:"rgba(0, 0, 0, 0.8)"});var e=[new h.fabric.Rect({rx:10,ry:10,width:300,height:300,fill:t.fill||"rgba(0, 0, 0, 0.3)",stroke:t.stroke||"rgba(255, 0, 0, 0)",strokeWidth:2}),this.label],i=Object.assign({},t,{id:t.id||Object(f.a)(),width:300,height:300,originX:"left",originY:"top",hasRotatingPoint:!0,hasControls:!0});this.callSuper("initialize",e,i),this.label.set({top:this.label.top+this.label.height/2+4,left:this.label.left+35})},toObject:function(){return h.fabric.util.object.extend(this.callSuper("toObject"),{id:this.get("id"),superType:this.get("superType"),children:this.get("children").map((function(t){return t.toObject()}))})},addChild:function(t){this.children.includes(t)||(t.set("parentId",this.id),this.children.push(t))},removeChild:function(t){t.set("parentId",null),h.fabric.util.removeFromArray(this.children,t)},_render:function(t){this.callSuper("_render",t)}}),b=function(){var t=Object(n.useRef)(null),e=Object(n.useState)(null),i=Object(d.a)(e,2),o=i[0],a=i[1];Object(n.useEffect)((function(){var t=new h.fabric.Canvas("canvasId",{preserveObjectStacking:!0,width:700,height:700,selection:!0,defaultCursor:"default",backgroundColor:"#f3f3f3"});t.add(new p({id:"task1",top:100,left:100,fill:"red",hasControls:!0,hasRotatingPoint:!1})),t.add(new u({id:"process1",top:200,left:200,stroke:"black",strokeWidth:10,fill:"rgba(0,0,0,0)",hasControls:!0,hasRotatingPoint:!1})),window.canvas=t,a(t),t.on({"object:moving":function(i){if("subProcess"===i.target.superType){var r=i.target;if(r.setCoords(),Array.isArray(i.target.children)){var n=r.left-e[r.id].left,o=r.top-e[r.id].top;i.target.children.forEach((function(i){i.left=e[i.id].left+n,i.top=e[i.id].top+o,i.setCoords(),t.bringToFront(i)}))}t.renderAll()}t.forEachObject((function(e){if(e!==i.target&&"subProcess"===e.superType){var r=e;t.bringToFront(i.target);var n=i.target.intersectsWithObject(r)?"red":"black";if(r._objects[0].set("stroke",n),t.renderAll(),i.target.intersectsWithObject(r)||r.removeChild(i.target),"node"===i.target.superType&&i.target.intersectsWithObject(r)){var o=i.target,a=r.top,s=a+r.height,l=r.left,c=l+r.width;r.addChild(o),o.left=Math.min(Math.max(o.left,l),c-o.width),o.top=Math.min(Math.max(o.top,a),s-o.height)}}}))},"mouse:down":function(i){var r=t.getObjects();e=r.reduce((function(t,e){return e?Object(c.a)(Object(c.a)({},t),{},Object(l.a)({},e.id,{top:e.top,left:e.left})):t}),{})}});var e={}}),[]);return Object(r.jsxs)("div",{children:[Object(r.jsx)("button",{onClick:function(){var t=o.toObject().objects,e=[],i=function t(e){var i,r={id:e.id,superType:e.superType,parentId:e.parentId,properties:{left:e.left,top:e.top}};e.children&&(r.children=null===(i=e.children)||void 0===i?void 0:i.map((function(e){return t(e)})));return r};t.forEach((function(t){"node"!==t.superType&&"subProcess"!==t.superType||t.parentId||e.push(i(t))})),window.nodes=e,console.log(e)},children:"Serialize"}),Object(r.jsx)("button",{onClick:function(){if(console.log("loading",window.nodes),window.nodes){o.clear();var t=function(t){var e=new p({id:t.id,top:t.properties.top,left:t.properties.left,fill:"red",parentId:t.parentId});return o.add(e),e};window.nodes.forEach((function(e){if("node"===e.superType)t(e);else if("subProcess"===e.superType){var i=new u({id:e.id,top:e.properties.top,left:e.properties.left,children:e.children.map((function(e){return t(e)}))});o.add(i),o.sendToBack(i)}}))}},children:"Load snapshop"}),Object(r.jsx)("button",{onClick:function(){o.add(new p({id:Object(f.a)(),top:50,left:50,fill:"red",hasControls:!0,hasRotatingPoint:!1}))},children:"Add Task"}),Object(r.jsx)("div",{ref:t,style:{width:700,height:700,border:"1px solid gray"},children:Object(r.jsx)("canvas",{style:{width:"100%",height:"100%"},id:"canvasId"})})]})},g=function(){return Object(r.jsx)(b,{})};s.a.render(Object(r.jsx)(o.a.StrictMode,{children:Object(r.jsx)(g,{})}),document.getElementById("root"))}},[[23,1,2]]]);
//# sourceMappingURL=main.223c4cc3.chunk.js.map